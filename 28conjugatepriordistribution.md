# 共轭先验分布（conjugate prior distribution）
### 2019302110263韦宸

下面将介绍贝叶斯估计中一种简便推算后验分布的理论方法——共轭先验分布。

## 一、定义

如果F函数是一类抽样分布$p(y|\theta)$，$P$函数是一类的先验分布，**$P$和$F$共轭**的需要满足以下**条件：**
$$
p(\theta|y)\in P
$$
对于所有$p(·|\theta)\in F~~~~~~p(·)\in P$成立。

这个定义从形式上看是模糊的，因为如果我们选择作为所有分布的类，那么$P$总是共轭的，不管使用什么样的抽样分布。我们当然对于**自然共轭先验族**是最感兴趣的，因为它是通过将P作为具有与似然相同函数形式的所有密度函数的集合而产生的。

在第四模块我们会以常见分布（泊松分布等）为例做具体介绍。



## 二、优点

使用共轭先验分布的**理由**与使用有代表性的模型（如二项式和正态）的似然函数类似：

1、**简化计算结果易于理解**

通常可以用解析形式表示，它们通常是一个很好的近似值，并且**简化了计算**。

2、**用作更复杂模型的构建块**

包括在通常不可能寻找共轭的很多维度中。在这种情况下，共轭模型是很好的起点；例如，当简单的共轭分布不合理时，**共轭族的混合**有时是有用的。



## 三、指数分布族的共轭先验形式

首先说明一个定理：**指数族形式的概率分布都有共轭先验分布**。

在此我们回顾一下指数分布族形式，如果$F$函数为以下形式（**似然函数**）
$$
p(y_i|\theta)=f(y_i)g(\theta)e^{\phi(\theta)^Tu(y_i)}
$$
**先验分布**有以下形式
$$
p(\theta)\propto g(\theta)^\eta e^{\phi(\theta)^T(v+t(y))}
$$
那么相应的**后验分布**为
$$
p(\theta|y)\propto g(\theta)^{\eta+n} e^{\phi(\theta)^T(v+t(y))}
$$
其中，n为样本数据的个数，先验分布和后验分布的形式是相同的，也就是先验和后验分布是共轭的。

这表明，如果可以将任意似然函数写成指数分布族的形式，那么可以自然的写出其先验分布和后验分布，这为我们的后续计算提供了极大便利。一般来说，指数族是唯一具有自然共轭先验分布的分布类。



## 四、常见分布及其共轭先验

### 1、二项分布

二项分布的**似然函数**形式为：
$$
p(y|\theta)\propto \theta^a(1-\theta)b
$$
因此，如果先验分布具有相同的形式，具有其自身的值a和b，则后验分布也将是这种形式。我们将把这样一个**先验分布**化为
$$
p(\theta)\propto \theta^{\alpha-1}(1-\theta)^{\beta-1}
$$
这是一个$Beta分布$，参数为$α$和β，$θ∼ β（α，β）$。

对应的**后验分布**可以推导：
$$
p(\theta|y)\propto \theta^{y}(1-\theta)^{n-y}\theta^{\alpha-1}(1-\theta)^{\beta-1}\\=\theta^{y+\alpha-1}(1-\theta)^{n-y+\beta-1}\\=Beta(\theta|\alpha+y,\beta+n-y)\\{后验分布的方差和均值为：}\\
E(\theta|y)=\frac{\alpha+y}{\alpha+\beta+n}\\
var(\theta|y)=\frac{(\alpha+y)(\beta+n-y)}{(\alpha+\beta+n)^2(\alpha+\beta+n+1)}=\frac{E(\theta|y)[1-E(\theta|y)]}{\alpha+\beta+n+1}
$$
随着$y和n$变大，$α$和$β$固定
$$
E(\theta|y)\approx\frac{y}{n}\\
var(\theta|y)\approx\frac{1}{n}\frac{y}{n}(1-\frac{y}{n})
$$
以$1/n$的速率接近零。在极限情况下，先验分布的参数对后验分布无影响。

可以得出结论：**贝塔分布是一个二项分布的共轭先验分布**。



### 2、正态分布

考虑方差已知的正态分布，**样本分布**（似然函数）为：
$$
p(y|\theta)=\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{1}{2\sigma^2}(y-\theta)^2}
$$

作为$θ$的函数，似然函数是$θ$的指数分布族函数，因此**共轭先验**密度族形式为
$$
p(\theta)=e^{A\theta^2+B\theta+C}
$$
将其参数化为：
$$
p(\theta)\propto exp(-\frac{1}{2\tau^2_0}(\theta-\mu_0)^2)\\\theta～N(\mu_0,\tau_0^2)
$$
在这个过程中，我们通常假设超参数是已知的。共轭先验密度意味着θ的后验分布是二次型指数形式，因此也是正态分布，我们从参数的角度来看。

在**后验分布**中，除θ外的所有变量均视为常数，有
$$
p(\theta|y)\propto exp(-\frac{1}{2}(\frac{(y-\theta)^2}{\sigma^2}+\frac{(\theta-\mu_0)^2}{\tau_0^2}))
$$
展开指数合并后，可以得到与先验分布类似的形式，且可以得到后验分布的参数与先验分布的参数关系。
$$
p(\theta)\propto exp(-\frac{1}{2\tau^2_1}(\theta-\mu_1)^2)\\\theta|p～N(\mu_1,\tau_1^2)\\\mu_1=\frac{\frac{1}{\tau_0^2}\mu_0+\frac{1}{\sigma^2}y}{\frac{1}{\tau_0^2}+\frac{1}{\sigma^2}}\\
\frac{1}{\tau_1^2}=\frac{1}{\tau_0^2}+\frac{1}{\sigma^2}
$$
可以得出结论：**正态分布是方差已知的正态分布的共轭先验分布**。



## 3、泊松分布



泊松分布形式为：
$$
p(y|\theta)\propto \frac{\theta^ye^{-\theta}}{y!},y=0,1,2...
$$
对于y次独立试验，泊松分布的**似然函数**形式为：
$$
p(y|\theta)=\prod_{i = 1}^{n}\frac{1}{y_i!}\theta^{y_i}e^{-\theta}\\ \propto \theta^{t(y)}e^{-n\theta}\\t(y)=\sum_{i = 1}^{n}y_i
$$
$t(y)$是一个充分统计量，我们可以将似然函数写成**指数分布族的形式**便于进行共轭先验的推导：
$$
p(y|\theta)\propto e^{n\theta}e^{t(y)log\theta}
$$
其**共轭先验分布**为：
$$
p(\theta)\propto (e^{-\theta})^\eta e^{\nu log\theta}
$$
式中含有超参数（*η* ,$\nu$），换句话说，似然函数是$\theta^ae^{-b\theta}$形式，所以共轭先验分布应$p(\theta)\propto \theta^Ae^{-B\theta}$形式，在更传统的参数化中，**先验分布**为以下形式：
$$
p(\theta)\propto e^{-\beta\theta}\theta^{\alpha-1}
$$
所以，泊松分布的先验分布实质为$Gamma(\alpha,\beta)$的伽马分布。根据共轭先验分布，**后验分布**为
$$
\theta|y～Gamma(\alpha+n\bar{y},\beta+n)
$$
可以得出结论：**$Gamma分布$是泊松分布的共轭先验分布**。



## 五、案例

#### **案例1:**从二项数据估计女婴前置胎盘的可能性

#### 问题

作为一个可能影响性别比的因素的具体例子，我们考虑了母体状态前置胎盘，这是一种不寻常的妊娠状态，胎盘植入子宫内，阻碍胎儿正常的阴道。一项关于德国前置胎盘出生性别的早期研究发现，在980例分娩中，437例为女婴。有多少证据表明前置胎盘出生人口中女孩出生的比例低于0.485，即**患病的女婴在总人口中的比例**？

#### **分析**

**（1）未知先验信息**

患病婴儿的性别服从二项分布。当未知先验信息（即$\alpha,\beta=1$）时，共轭先验分布为均匀分布，**后验分布**为
$$
Beta(\theta|1+437,1+980-437)=Beta(\theta|438,544)
$$
由$Beta{分布}$的性质可以得到后验分布的均值和标准差： θ的后验均值为0.446，后验标准差为0.016。精确的后分位数可以通过对密度函数的数值积分得到，在实践中通过计算机函数调用来实现；中位数为0.446，中心95%后验区间为$[0.415,0.477]$。这个95%的后验区间与三个小数点后位相匹配，该区间将通过使用计算后验均值和标准偏差的正态近似得到。在这个例子中，我们得到女孩的出生人口在总人口的比例为后验分布的均值：0.446。

**（2）先验信息的不同选取方式**

<img src="https://github.com/chenchen411/2021BayesianCourse/blob/main/figure/wc_figure1.png" alt="wc_figure1" style="zoom:80%;" />

​                                                        **图1 不同$α ，β$的值对$\theta$值的影响**

通过计算机对$α ，β$的值模拟得到的后验分布参数的中位数和95%置信区间如图所示，进一步分析不同先验信息对后验分布的影响：在表中第一行对应的是均匀的先验分布，$α = 1， β = 1$，表中随后几行使用的先验分布越来越集中在0.485(女性出生在总人口中的比例)附近。第一列表示θ的先验均值，第二列表示先验信息量，用$α + β$测量；回想一下，在某种意义上，$α + β - 2$等于先前的观测数。基于大样本的后验推论对先验分布不是特别敏感。只有在表格的底部，即先验分布包含相当于100或200个新生儿的信息，后验分布的区间明显地被拉向先验分布，即使如此，95%后验置信区间仍然排除了先验均值。



#### 案例二：从泊松数据估计死亡率（一个理想化的例子）

#### 问题

假设对美国某城市一年内的死亡原因进行了详细审查。据发现，在20万人口中有3人死于哮喘，粗略估计该市每年每10万人中有1.5例哮喘死亡。**寻找先验信息估计哮喘死亡率**。

#### 分析

**（1）样本数据**

这种形式的流行病学数据常采用**泊松抽样模型**。泊松模型是由所有小曝光间隔之间的可交换性的假设推导而来的。在泊松模型下，y的抽样分布，即一个城市每年20万人的死亡人数，可以表示为$Poisson(2.0\theta)$， θ代表我市真实的潜在长期哮喘死亡率（$\theta$单位：每年每10万人的病例数）。y = 3是x = 2.0和未知率θ的一个**样本观察值**。我们可以利用世界各地哮喘死亡率的知识来构建$\theta$的先验分布，然后将样本数据y = 3与先验分布相结合，得到后验分布。

**（2）先验分布**

那么**先验分布**是什么呢？对世界各地哮喘死亡率的回顾表明，在西方国家，每10万人中1.5人以上的死亡率是罕见的，典型的哮喘死亡率约为每10万人0.6人。反复对伽马分布的参数进行调整和对历史数据的分析，显示在本例下$Gamma~(3.0,5.0)$是一个合理的**先验分布**。这一先验分布的平均值为0.6(模式为0.4)，密度的97.5%位于1.44以下。在实际应用中，指定先验均值可以确定两个gamma参数的比值，然后通过试错来改变$\alpha,\beta$，以匹配关于分布尾部的先验知识。

**（3）后验分布**

在$Gamma(α， β)$先验分布情况下，**θ的后验分布**为$Gamma(α + y， β + x)$。根据先验分布和所描述的数据，θ的后验分布为$Gamma(6.0, 7.0)，其均值为0.86 $，$\theta$的值从样本数据的1.5到0.86，向先验分布发生了重大收缩。从θ的后验分布进行1000次抽样得到的直方图如图2（a）所示，我市哮喘长期死亡率的后验概率较高。

 
<img src="https://github.com/chenchen411/2021BayesianCourse/blob/main/figure/wc_figure2.png" alt="wc_figure2" style="zoom:80%;" />



**图2  θ的后验分布**，即每年每10万人的哮喘死亡率，在$Gamma(3.0, 5.0)$先验分布下：

(a)左图，假定$y = 3 / 20$万人死亡；(b)右图，假设在20万人口不变的情况下，10年内$y = 30$人死亡。直方图呈现出锯齿状，因为它们是由每一种情况下的后验分布中1000次抽样构成的。





## 六、总结

| 分布               | 似然函数                                                     | 先验分布                      | 后验分布                                                     |
| ------------------ | ------------------------------------------------------------ | ----------------------------- | ------------------------------------------------------------ |
| 泊松分布           | $p(y|\theta)\propto \theta^a(1-\theta)b$                     | $θ∼ β（α，β）$                | $\theta～Beta(\theta|\alpha+y,\beta+n-y)$                    |
| 正态分布(已知方差) | $p(y|\theta)=\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{1}{2\sigma^2}(y-\theta)^2}$ | $\theta～N(\mu_0,\tau_0^2)$   | $\theta～N(\mu_1,\tau_1^2)\\u_1=\frac{\frac{1}{\tau_0^2}\mu_0+\frac{1}{\sigma^2}y}{\frac{1}{\tau_0^2}+\frac{1}{\sigma^2}}\\\frac{1}{\tau_1^2}=\frac{1}{\tau_0^2}+\frac{1}{\sigma^2}$ |
| 二项分布           | $p(y|\theta)\propto \frac{\theta^ye^{-\theta}}{y!},y=0,1,2...$ | $\theta～Gamma(\alpha,\beta)$ | $\theta|y～Gamma(\alpha+n\bar{y},\beta+n)$                   |



## 七、参考文献

Bayesian Data Analysis(Third Edition),C-Gelman,Andrew,Chapter2.1～2.7
